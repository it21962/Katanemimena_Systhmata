<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <title>Διαχείριση Ενοικιάσεων Ακινήτων</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRP6ziJH3f1f-lOFeK02tostig8R3idf5VIfQ&s') no-repeat center center fixed;
            background-size: cover;
            color: #333;
            margin: 0;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.5);
            z-index: -1;
        }

        header {
            text-align: right;
            padding: 20px;
            background-color: #0055bb;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
            right: 20px;
        }

        .dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            text-align: left;
        }

        .dropdown-content a:hover {background-color: #f1f1f1}

        .user-menu {
            cursor: pointer;
            border: none;
            background: transparent;
        }

        .user-menu img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
        }

        nav {
            background-color: #007bff;
            padding: 10px 0;
            text-align: center;
        }

        nav a {
            color: white;
            margin: 0 15px;
            text-decoration: none;
            cursor: pointer;
        }

        .content {
            display: none;
            padding: 20px;
            text-align: center;
        }

        .active {
            display: block;
        }

        footer {
            text-align: center;
            background-color: #f8f8f8;
            position: fixed;
            bottom: 0;
            width: 100%;
            padding: 10px;
            box-shadow: 0 -2px 5px rgba(0,0,0,0.1);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        footer a {
            color: #007bff;
            margin: 0 10px;
            text-decoration: none;
        }

        table {
            width: 90%;
            margin: 20px auto;
            border-collapse: collapse;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        th {
            background-color: #007bff;
            color: white;
            padding: 12px;
            text-align: center;
            font-size: 16px;
        }

        td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #ddd;
            font-size: 14px;
        }

        tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        tr:hover {
            background-color: rgba(0, 123, 255, 0.2);
        }

        button {
            padding: 6px 12px;
            font-size: 14px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease-in-out;
        }

        button.approve-btn {
            background-color: #28a745;
            color: white;
        }

        button.approve-btn:hover {
            background-color: #218838;
        }

        button.reject-btn {
            background-color: #dc3545;
            color: white;
        }

        button.reject-btn:hover {
            background-color: #c82333;
        }

        .property-form-container {
            width: 50%;
            margin: 20px auto;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .property-form-container h2 {
            text-align: center;
            margin-bottom: 15px;
            color: #333;
        }

        .property-form-container label {
            font-weight: bold;
            display: block;
            margin: 10px 0 5px;
            text-align: left;
        }

        .property-form-container input,
        .property-form-container select,
        .property-form-container textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }

        .property-form-container button {
            width: 100%;
            background-color: #007bff;
            color: white;
            border: none;
            padding: 12px;
            font-size: 18px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease-in-out;
        }

        .property-form-container button:hover {
            background-color: #0056b3;
        }

        .contact-form-container {
            width: 50%;
            margin: 20px auto;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .contact-form-container h2 {
            text-align: center;
            margin-bottom: 15px;
            color: #333;
        }

        .contact-form-container label {
            font-weight: bold;
            display: block;
            margin: 10px 0 5px;
            text-align: left;
        }

        .contact-form-container input,
        .contact-form-container textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }

        .contact-form-container textarea {
            height: 100px;
            resize: none;
        }

        .contact-form-container button {
            width: 100%;
            background-color: #007bff;
            color: white;
            border: none;
            padding: 12px;
            font-size: 18px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease-in-out;
        }

        .contact-form-container button:hover {
            background-color: #0056b3;
        }

    </style>
</head>
<body>
<div class="overlay"></div>
<header>
    <div>Welcome to Our Service</div>
    <div class="user-menu" onclick="toggleDropdown()">
        <img src="https://www.clipartmax.com/png/middle/258-2582267_circled-user-male-skin-type-1-2-icon-male-user-icon.png" alt="User Menu">
        <div class="dropdown-content">
            <a href="javascript:void(0)" id="username-display">Username Placeholder</a>
            <a href="login.html" onclick="logout()">Αποσύνδεση</a>
        </div>
    </div>
</header>

<nav>
    <a onclick="showSection('home')">Αρχική</a>
    <a onclick="showSection('about')">Σχετικά με Εμάς</a>
    <a onclick="showSection('properties')">Ακίνητα</a>
    <a onclick="showSection('rentals')">Αιτήσεις</a>
    <a onclick="showSection('listings')">Καταχωρήσεις</a>
    <a onclick="showSection('contact')">Επικοινωνία</a>
</nav>

<div class="content active" id="home">
    <h1>Καλώς Ήρθατε στη Διαχείριση Ενοικιάσεων Ακινήτων</h1>
</div>

<div class="content" id="about">
    <h2>Σχετικά με Εμάς</h2>
    <p>Η <strong>Διαχείριση Ενοικιάσεων Ακινήτων</strong> ξεκίνησε το 2010 με στόχο την παροχή ποιοτικών λύσεων στη διαχείριση ακινήτων. Με έδρα την Αθήνα, η εταιρεία μας έχει επεκταθεί γρήγορα, προσφέροντας ένα ευρύ φάσμα υπηρεσιών που καλύπτουν τις ανάγκες των ιδιοκτητών ακινήτων, επενδυτών και ενοικιαστών.</p>
    <p>Η φιλοσοφία μας βασίζεται στη διαφάνεια, την ακεραιότητα και την εξαιρετική εξυπηρέτηση πελατών. Αναλαμβάνουμε τη διαχείριση κάθε είδους ακινήτου, από μικρά διαμερίσματα μέχρι μεγάλα εμπορικά κτήρια, εξασφαλίζοντας την άριστη κατάσταση και απόδοση τους.</p>
    <p>Παρέχουμε τις εξής υπηρεσίες:
    <ul>
        <li>Πλήρης διαχείριση ακινήτων</li>
        <li>Τεχνική υποστήριξη και συντήρηση</li>
        <li>Διαχείριση ενοικιάσεων και εξεύρεση ενοικιαστών</li>
        <li>Νομική υποστήριξη και συμβουλευτικές υπηρεσίες</li>
        <li>Οικονομική διαχείριση και εκπόνηση αναφορών</li>
    </ul>
    </p>
    <p>Με έμπειρο προσωπικό και σύγχρονες τεχνολογίες, εγγυόμαστε την ομαλή λειτουργία και τη μέγιστη αποδοτικότητα του ακινήτου σας, αξιοποιώντας κάθε δυνατότητα για αύξηση της αξίας του. Είμαστε εδώ για να κάνουμε τη διαχείριση των ακινήτων σας απλή και αποδοτική.</p>
    <p>Επικοινωνήστε μαζί μας σήμερα για να μάθετε περισσότερα για τις υπηρεσίες μας ή για να ξεκινήσετε τη συνεργασία με την <strong>Διαχείριση Ενοικιάσεων Ακινήτων</strong>.</p>
</div>

<div class="content" id="properties">
    <h2>Ακίνητα</h2>
    <div class="property-buttons">
        <button onclick="showOwnerProperties()">Τα Ακίνητα Μου</button>
        <button onclick="showAllProperties()">Όλα τα Ακίνητα</button>
    </div>

    <div id="property-section" style="display: none;">
        <table id="property-table">
            <thead>
            <tr>
                <th>ID</th>
                <th>Τίτλος</th>
                <th>Περιγραφή</th>
                <th>Κατάσταση</th>
            </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
</div>

<div class="content" id="rentals">
    <h2>Αιτήσεις</h2>
    <label for="status-filter">Φιλτράρισμα κατά κατάσταση:</label>
    <select id="status-filter" onchange="filterRentals()">
        <option value="all">Όλες</option>
        <option value="pending">Σε αναμονή</option>
        <option value="approved">Εγκεκριμένες</option>
        <option value="rejected">Απορριφθείσες</option>
    </select>

    <table id="rental-requests-table">
        <thead>
        <tr>
            <th>ID</th>
            <th>Χρήστης</th>
            <th>Ακίνητο</th>
            <th>Ημερομηνία</th>
            <th>Κατάσταση</th>
            <th>Ενέργειες</th>
        </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>


<div class="content property-form-container" id="listings">
    <h2>Δημιουργία Νέας Καταχώρησης</h2>

    <form id="add-property-form">
        <label for="property-title">Τίτλος Ακινήτου:</label>
        <input type="text" id="property-title" placeholder="Π.χ. Πολυτελής Βίλα" required>

        <label for="property-description">Περιγραφή:</label>
        <textarea id="property-description" placeholder="Σύντομη περιγραφή του ακινήτου..." required></textarea>

        <label for="property-status">Κατάσταση:</label>
        <select id="property-status">
            <option value="available">Διαθέσιμο</option>
            <option value="unavailable">Μη διαθέσιμο</option>
        </select>

        <button type="submit">Προσθήκη Καταχώρησης</button>
    </form>
</div>

<div class="content contact-form-container" id="contact">
    <h2>Επικοινωνία</h2>

    <form id="contact-form">
        <label for="name">Ονοματεπώνυμο:</label>
        <input type="text" id="name" name="name" placeholder="Π.χ. Βασίλης Νούσης" required>

        <label for="email">Email:</label>
        <input type="email" id="email" name="email" placeholder="vasilis@gmail.com" required>

        <label for="message">Μήνυμα:</label>
        <textarea id="message" name="message" placeholder="Πληκτρολογήστε το μήνυμά σας εδώ..." required></textarea>

        <button type="submit">Αποστολή</button>
    </form>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        checkUserSession();
        setupFormListeners();
        loadOwnerId();
    });

    function checkUserSession() {
        const username = sessionStorage.getItem("loggedInUser");
        if (!username) {
            alert("Δεν υπάρχει συνδεδεμένος χρήστης! Μεταφορά στη σελίδα σύνδεσης.");
            window.location.href = "login.html";
            return;
        }
        document.getElementById("username-display").textContent = username;
    }

    function loadOwnerId() {
        const username = sessionStorage.getItem("loggedInUser");

        if (!username) {
            console.error("Δεν υπάρχει συνδεδεμένος χρήστης!");
            return;
        }

        fetch(`/api/get-current-user-id?username=${username}`)
            .then(response => response.json())
            .then(data => {
                if (!data || !data.userId) throw new Error("Δεν βρέθηκε ID ιδιοκτήτη!");

                sessionStorage.setItem("ownerId", data.userId);
                console.log("Owner ID:", data.userId);

                loadProperties();
                loadRentalRequests();
            })
            .catch(error => console.error("Σφάλμα:", error));
    }

    function loadProperties() {
        const ownerId = Number(sessionStorage.getItem("ownerId"));

        if (!ownerId) {
            console.error("Δεν υπάρχει Owner ID!");
            return;
        }

        fetch(`/owner/properties?ownerId=${ownerId}`)
            .then(response => response.json())
            .then(properties => {

                const ownerProperties = properties.filter(property => property.ownerId == ownerId);

                const tableBody = document.querySelector("#property-table tbody");
                if (!tableBody) {
                    console.error("Ο πίνακας ακινήτων δεν βρέθηκε στη σελίδα.");
                    return;
                }
                tableBody.innerHTML = "";

                ownerProperties.forEach(property => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                    <td>${property.id}</td>
                    <td>${property.title}</td>
                    <td>${property.description}</td>
                    <td>${property.status}</td>
                `;
                    tableBody.appendChild(row);
                });
            })
            .catch(error => console.error("Σφάλμα κατά την ανάκτηση ακινήτων:", error));
    }

    function loadAllProperties() {
        fetch(`/owner/properties`)
            .then(response => response.json())
            .then(properties => {
                console.log("Όλα τα ακίνητα από το API:", properties);

                const tableBody = document.querySelector("#property-table tbody");
                if (!tableBody) {
                    console.error("Ο πίνακας ακινήτων δεν βρέθηκε στη σελίδα.");
                    return;
                }
                tableBody.innerHTML = "";

                properties.forEach(property => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                <td>${property.id}</td>
                <td>${property.title}</td>
                <td>${property.description}</td>
                <td>${property.status}</td>
            `;
                    tableBody.appendChild(row);
                });
            })
            .catch(error => console.error("Σφάλμα κατά την ανάκτηση όλων των ακινήτων:", error));
    }

    function showOwnerProperties() {
        document.getElementById("property-section").style.display = "block";
        loadProperties();
    }

    function showAllProperties() {
        document.getElementById("property-section").style.display = "block";
        loadAllProperties();
    }

    function loadRentalRequests() {
        const ownerId = sessionStorage.getItem("ownerId");

        if (!ownerId) {
            console.error("Δεν υπάρχει Owner ID!");
            return;
        }

        fetch(`/tenant/rental-requests/owner?ownerId=${ownerId}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Σφάλμα API: ${response.status} - ${response.statusText}`);
                }
                return response.json();
            })
            .then(requests => {
                console.log("Rental Requests για Owner:", requests);
                renderRentalTable(requests);
            })
            .catch(error => console.error("Σφάλμα κατά την ανάκτηση των rental requests:", error));
    }

    function renderRentalTable(requests) {
        const tableBody = document.querySelector("#rental-requests-table tbody");
        if (!tableBody) {
            console.error("Ο πίνακας αιτήσεων δεν βρέθηκε στη σελίδα.");
            return;
        }

        tableBody.innerHTML = '';

        requests.forEach(request => {
            const row = document.createElement("tr");
            row.innerHTML = `
        <td>${request.id}</td>
        <td>${request.user ? request.user.name : 'N/A'}</td>
        <td>${request.property ? request.property.title : 'N/A'}</td>
        <td>${new Date(request.requestDate).toLocaleDateString('el-GR')}</td>
        <td>${request.status}</td>
        <td>
            <button onclick="updateRentalStatus(${request.id}, 'approved')" class="approve-btn">Έγκριση</button>
            <button onclick="updateRentalStatus(${request.id}, 'rejected')" class="reject-btn">Απόρριψη</button>
        </td>
    `;
            tableBody.appendChild(row);
        });
    }

    function updateRentalStatus(requestId, newStatus) {
        fetch(`/tenant/rental-requests/update/${requestId}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ status: newStatus })
        })
            .then(response => response.json())
            .then(() => {
                alert(`Η αίτηση ${requestId} ενημερώθηκε σε ${newStatus}`);
                loadRentalRequests();
                loadProperties();
            })
            .catch(error => console.error('Σφάλμα στο Fetch:', error));
    }

    document.addEventListener("DOMContentLoaded", function () {
        loadRentalRequests();
    });

    function setupFormListeners() {
        const addPropertyForm = document.getElementById("add-property-form");

        if (!addPropertyForm) {
            console.error("Η φόρμα καταχώρησης δεν βρέθηκε.");
            return;
        }

        addPropertyForm.addEventListener("submit", function (event) {
            event.preventDefault();

            const title = document.getElementById("property-title").value.trim();
            const description = document.getElementById("property-description").value.trim();
            const status = document.getElementById("property-status").value.trim();
            const ownerId = sessionStorage.getItem("ownerId");

            if (!ownerId) {
                alert("Δεν βρέθηκε ID ιδιοκτήτη!");
                return;
            }

            fetch("/owner/properties/add-property", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ title, description, status, ownerId })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success === "true") {
                        alert("Η καταχώρηση προστέθηκε επιτυχώς!");

                        addPropertyForm.reset();

                        loadProperties();
                    } else {
                        alert("Σφάλμα: " + data.message);
                    }
                })
                .catch(error => console.error("Σφάλμα:", error));
        });
    }

    function showSection(sectionId) {
        const section = document.getElementById(sectionId);
        if (!section) {
            console.error(`Η ενότητα "${sectionId}" δεν βρέθηκε.`);
            return;
        }

        document.querySelectorAll('.content').forEach(s => s.style.display = 'none');
        section.style.display = 'block';
    }

    function toggleDropdown() {
        var dropdown = document.querySelector('.dropdown-content');
        dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
    }

    function logout() {
        sessionStorage.removeItem("loggedInUser");
        sessionStorage.removeItem("ownerId");
        window.location.href = "login.html";
    }
</script>
</body>
</html>
